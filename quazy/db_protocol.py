import typing

from .db_table import DBTable

if typing.TYPE_CHECKING:
    from typing import *
    from types import SimpleNamespace

__all__ = ['DBRowFactoryLike', 'DBRowLike', 'DBCopyLike', 'DBCursorLike', 'DBConnectionLike', 'DBPoolLike']

DBRowFactoryLike = 'Callable[[type[DBTable] | None], type]'
DBRowLike = DBTable | tuple | dict

class DBCopyLike(typing.Protocol):
    """Protocol for database copy"""
    def write_row(self, values: tuple): ...

class DBCursorLike(typing.Protocol):
    """Protocol for database cursor"""
    description: Sequence[tuple[str, ...]] | None
    def execute(self, sql: str, values: Optional[Sequence[Any]] = None) -> Iterator[SimpleNamespace | dict[str, Any] | DBTable]: ...
    def executemany(self, sql: str, values: Sequence[Sequence[Any]]) -> Iterable[Any]: ...
    def executescript(self, sql: str, values: Sequence[Sequence[Any]]) -> Iterable[Any]: ...
    def fetchone(self) -> Optional[tuple[Any]]: ...
    def fetchall(self) -> list[tuple[Any]]: ...
    def copy(self, sql: str) -> ContextManager[DBCopyLike]: ...
    def commit(self) -> None: ...

class DBConnectionLike(typing.Protocol):
    """Protocol for database connection"""
    def cursor(self, binary: bool=False, row_factory: type=None, **kwargs) -> ContextManager[DBCursorLike]: ...
    def execute(self, sql: str, values: Optional[Sequence[Any]] = None) -> Iterable[Any]: ...
    def executemany(self, sql: str, values: Sequence[Sequence[Any]]) -> Iterable[Any]: ...
    def executescript(self, sql: str) -> Iterable[Any]: ...
    def transaction(self) -> ContextManager[None]: ...
    def commit(self) -> None: ...

class DBPoolLike(typing.Protocol):
    """Protocol for database pool"""
    def connection(self, **kwargs) -> ContextManager[DBConnectionLike]: ...
